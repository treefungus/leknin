import random
import datetime
import csv

#phrases bank
greetings = ["ahoj", "hi", "hello", "čau"]

howdy = ["Jak se máš?", "Jak to šlape?", "What is up, pirate?"]
howdy_plus = ["fajn", "dobře", "jde to", "ok"]
howdy_minus = ["nic moc", "špatně", "bad"]

ans_cheer = ["To je super", "Paráda!"]
ans_symp = ["To mě mrzí", "To nerad slyším"]

talk = ["Co se ti zdálo?", "Na co se chystáš?"]

talk_open = ["O čem chceš mluvit?"]

time = datetime.datetime.now()


# remembering answers

short_memory = []

def remember(file, x):
    file_name = file + ".csv"
    with open(file_name, "a+") as file:
        file.write("\n" + str(time) + "," + str(x))
        file.close
    return x

# expressing sentiment: only can do listed words

def sentiment():
    print(random.choice(ans_symp))

 
# asks for consent; should narrow down

def consent():
    no = ("no", "ne")
    x = None
    print("Chceš mi říct víc?")
    x = input()

    if x.lower() in no:
        print("OK. Not talking about this.")
        return False
    elif x.lower() == "ok":
        return True

# suggests topic by randomly choosing from memory: short-term/long-term to be distinguished

def idk():
  chosen_topic = []

  with open("topics.csv", "r") as topics:
    reader = csv.reader(topics)
    rand_choice = random.choice(list(reader))
    rand_text = rand_choice[1]

    print("How about " + str(rand_text) + "?")
    x = input()
    if x.lower() == "ok":
      short_memory.append(rand_text)
      print("Go on")
      x = input()

  return x

#talk loop

def talk_loop(phrase=talk_open[0], memory="topics"):

  print(str(phrase))
  x = input()

  if x.lower() == "bye":
    print("Remembering: " + str(short_memory))
    remember(memory, short_memory)
    return print("So long, funky boy!")

  elif x.lower() in ["nevím", "idk"]:
    x = idk()
    short_memory.append(x)
    talk_loop()

  else:
    short_memory.append(x)
    cons = consent()
    if cons == True:
        talk_loop(phrase="OK. Go on.")
    else:
        print("Remembering: " + str(short_memory))
        remember(memory, short_memory)
        talk_loop()

# sleeping intro
print("""
I'm sleeping bot. Say hi or something.  /// escape words: "idk", "no", "bye"
Spím. Pozdrav mě.                      /// únikové odpovědi: "nevím", "ne", "bye"

""")

# Hi

x = input()

if x.lower() in greetings:
    print(random.choice(greetings).title())
elif "wake up" in x.lower() and x.lower() not in greetings:
    print("Whoa whoa! How about nice hi first?")
else:
    print("Co to znamená?")
x = None

# How are you?

print(random.choice(howdy))
x = input()

if x.lower() in howdy_plus:
    print(random.choice(ans_cheer))
elif x.lower() in howdy_minus:
    print(random.choice(ans_symp))

remember("moods", x)
x = None

# Dreams or plans

choose_topic = random.choice(talk)

print(choose_topic)
x = input()

if choose_topic == talk[0]:
    remember("dreams", x)
else:
    remember("plans", x)

# should be: if...: sentiment()
for itm in howdy_minus:
    if str(itm) in x:
        sentiment()
x = None
y = consent()
remember("wildMemory", y)
y = None

# Topic of talk, start of loop

talk_loop(talk_open, "topics")